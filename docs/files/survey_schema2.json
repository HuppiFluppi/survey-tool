{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/HuppiFluppi/survey-tool/survey_schema.json",
  "title": "Survey/Quiz configuration file schema",
  "type": "array",
  "minItems": 2,
  "prefixItems": [
    {
      "$ref": "#/$defs/SurveyConfig"
    }
  ],
  "items": {
    "$ref": "#/$defs/PageConfig"
  },
  "$defs": {
    "SurveyConfig": {
      "title": "Survey configuration",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "title",
        "description"
      ],
      "properties": {
        "title": {
          "description": "Title of the survey",
          "type": "string",
          "minLength": 3
        },
        "description": {
          "description": "Description of the survey",
          "type": "string",
          "minLength": 20
        },
        "image_path": {
          "description": "Image to show at the top of the survey. Please make sure to use single quotes(') or use slash (/), not backslash for path separation",
          "type": "string",
          "minLength": 6
        },
        "type": {
          "description": "Type of the survey",
          "type": "string",
          "enum": [
            "survey",
            "quiz"
          ],
          "default": "survey"
        },
        "score": {
          "$ref": "#/$defs/ScoreSettings"
        }
      }
    },
    "PageConfig": {
      "title": "Page",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "content",
        "title"
      ],
      "properties": {
        "title": {
          "type": "string",
          "description": "Title of this page",
          "minLength": 3
        },
        "description": {
          "type": "string",
          "description": "Description of this page",
          "minLength": 20
        },
        "image_path": {
          "description": "Image to show at the top of this page. Please make sure to use single quotes(') or use slash (/), not backslash for path separation",
          "type": "string",
          "minLength": 6
        },
        "content": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/Question"
          }
        }
      }
    },
    "ScoreSettings": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "show_question_scores": {
          "type": "boolean",
          "description": "If true, achievable points are shown on each question",
          "default": false
        },
        "show_leaderboard": {
          "type": "boolean",
          "description": "Leaderboard is only relevant when type == \"quiz\"",
          "default": true
        },
        "leaderboard": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "show_scores": {
              "type": "boolean",
              "description": "Show scored points per participant in the leaderboard",
              "default": true
            },
            "show_placeholder": {
              "type": "boolean",
              "description": "Show placeholder rows to fill the leaderboard up to limit",
              "default": true
            },
            "limit": {
              "type": "integer",
              "description": "Number of entries to show in the leaderboard",
              "minimum": 0,
              "default": 10
            }
          }
        }
      }
    },
    "QuestionBase": {
      "type": "object",
      "required": [
        "type",
        "title"
      ],
      "properties": {
        "type": {
          "type": "string",
          "description": "Specify the type of question",
          "enum": [
            "data",
            "choice",
            "text",
            "rating",
            "likert",
            "datetime",
            "information"
          ]
        },
        "required": {
          "type": "boolean",
          "description": "If true, the user must answer this question",
          "default": true
        },
        "title": {
          "type": "string",
          "description": "Question/Headline to show to the user",
          "minLength": 5
        }
      }
    },
    "InformationContent": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "properties": {
        "type": {
          "const": "information"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the content block",
          "minLength": 20
        },
        "image_path": {
          "type": "string",
          "description": "Path to an image file to show below the title and description. Please make sure to use single quotes(') or use slash (/) not backslash for path separation",
          "minLength": 6
        }
      }
    },
    "DataQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "properties": {
        "type": {
          "const": "data"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "datatype": {
              "type": "string",
              "description": "Type of the data",
              "enum": [
                "name",
                "email",
                "phone",
                "custom"
              ],
              "default": "name"
            },
            "validation_pattern": {
              "type": "string",
              "description": "Regex pattern to validate the input. If omitted, data types name, email and phone use default patterns. Please make sure to use single quotes(') to avoid loading errors"
            },
            "use_for_leaderboard": {
              "type": "boolean",
              "description": "If true, this data will be used for the leaderboard. Only relevant for quizzes and data-type 'name'",
              "default": true
            }
          }
        }
      }
    },
    "ChoiceQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "required": [
        "config"
      ],
      "properties": {
        "type": {
          "const": "choice"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "choices"
          ],
          "properties": {
            "multiple": {
              "type": "boolean",
              "description": "Allow multiple selections",
              "default": false
            },
            "limit": {
              "type": "integer",
              "description": "Max selections when multiple == true; if 0, no limit",
              "minimum": 0,
              "default": 2
            },
            "dropdown": {
              "type": "boolean",
              "description": "Show a dropdown instead of checklist items. Only relevant if multiple == false",
              "default": false
            },
            "choices": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "title"
                ],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Title of the choice",
                    "minLength": 1
                  },
                  "correct": {
                    "type": "boolean",
                    "description": "If true, this choice is correct. Used in quiz mode",
                    "default": false
                  },
                  "score": {
                    "type": "integer",
                    "description": "Points to award for this choice. Used in quiz mode"
                  }
                }
              }
            }
          }
        }
      }
    },
    "TextQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "properties": {
        "type": {
          "const": "text"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "multiline": {
              "type": "boolean",
              "description": "If you expect lengthy answers, set this to true",
              "default": false
            },
            "score": {
              "type": "integer",
              "description": "Points to award for this question. Used in quiz mode",
              "minimum": 0
            },
            "correct_answer": {
              "type": "string",
              "description": "Correct answer to the question. Used in quiz mode"
            }
          }
        }
      }
    },
    "DatetimeQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "properties": {
        "type": {
          "const": "datetime"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "input_type": {
              "type": "string",
              "description": "Whether the user should input time, date or both",
              "enum": [
                "date",
                "time",
                "datetime"
              ],
              "default": "datetime"
            },
            "initial_selected_time": {
              "type": "string",
              "description": "If given, sets the initial selected time. Format: HH:mm",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$"
            },
            "initial_selected_date": {
              "type": "string",
              "description": "If given, sets the initial selected date. Format: YYYY-MM-DD",
              "pattern": "^(\\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$"
            },
            "score": {
              "type": "integer",
              "description": "Points to award for this question. Used in quiz mode",
              "minimum": 0
            },
            "correct_time_answer": {
              "type": "string",
              "description": "Correct time answer to the question. Used in quiz mode. Format: HH:mm",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$"
            },
            "correct_date_answer": {
              "type": "string",
              "description": "Correct date answer to the question. Used in quiz mode. Format: YYYY-MM-DD",
              "pattern": "^(\\d{4})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$"
            }
          }
        }
      }
    },
    "RatingQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "properties": {
        "type": {
          "const": "rating"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "levels": {
              "type": "integer",
              "description": "Number of rating options to show",
              "minimum": 3,
              "maximum": 10,
              "default": 5
            },
            "symbol": {
              "type": "string",
              "description": "Icon type for rating",
              "enum": [
                "like",
                "star",
                "heart",
                "smile"
              ],
              "default": "star"
            },
            "color_gradient": {
              "type": "string",
              "description": "Color scheme of the rating",
              "enum": [
                "none",
                "red2green"
              ],
              "default": "none"
            }
          }
        }
      }
    },
    "LikertQuestion": {
      "allOf": [
        {
          "$ref": "#/$defs/QuestionBase"
        }
      ],
      "required": [
        "config"
      ],
      "properties": {
        "type": {
          "const": "likert"
        },
        "config": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "choices",
            "statements"
          ],
          "properties": {
            "choices": {
              "title": "Likert scale options (columns)",
              "type": "array",
              "minItems": 2,
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "statements": {
              "title": "Likert statements (rows)",
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "title"
                ],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Title of the statement",
                    "minLength": 1
                  },
                  "correct_choice": {
                    "type": "string",
                    "description": "Correct choice for this statement. Needs to match one of the choices. Used in quiz mode"
                  },
                  "score": {
                    "type": "integer",
                    "description": "Points to award for this choice. Used in quiz mode",
                    "minimum": 0
                  }
                }
              }
            }
          }
        }
      }
    },
    "Question": {
      "oneOf": [
        {
          "$ref": "#/$defs/InformationContent"
        },
        {
          "$ref": "#/$defs/DataQuestion"
        },
        {
          "$ref": "#/$defs/ChoiceQuestion"
        },
        {
          "$ref": "#/$defs/TextQuestion"
        },
        {
          "$ref": "#/$defs/DatetimeQuestion"
        },
        {
          "$ref": "#/$defs/RatingQuestion"
        },
        {
          "$ref": "#/$defs/LikertQuestion"
        }
      ]
    }
  }
}
